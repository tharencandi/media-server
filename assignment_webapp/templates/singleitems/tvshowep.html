{% include 'top.html' %}
<div class="content">
    <div class="container details">
        <!-- Check if We have a valid tvshow ep -->
        {% if tvshowep | length > 0 %}
            <h2 class="title"> {{tvshowep[0].tvshow_episode_title}} aired on {{tvshowep[0].air_date}} </h2>
            <br/>
            <h2 class="title"> Season {{tvshowep[0].season}}, Episode {{tvshowep[0].episode}} </h2>
            <br/>
            
            <h3> Artworks </h3>
            {% for instance in tvshowep %}
                {% if instance.md_type_name == 'artwork' %}
                    <img src="{{instance.md_value}}" alt="image" style="width:500px;height:500px;">
                    <br/>Â© Amazon Public Domain 2019.
                {% endif %}
            {% endfor %}
            <br/>
            <h3> Descriptions </h3>
            {% for instance in tvshowep %}
                {% if instance.md_type_name == 'description' %}
                    <div>
                        {{instance.md_value}}
                    </div>
                {% endif %}
            {% endfor %}

            <h3> Watch </h3>
            <video controls class="video">
                <source src="{{url_for('static', filename=media_playback['storage_location'].storage_location)}}" type="video/mp4" preload="auto">
              Your browser does not support the video element.
            </video>

            <script>

                //event handlers trigger functions after listening to particular events on an HTML page
                //DOMContentLoaded gets trigger when the webpage content loads up
        
                // () => is an arrow function (will trigger function)
                document.addEventListener('DOMContentLoaded', () => {
        
                document.querySelectorAll('video').forEach(vid => {
                        if ("{{media_playback['position']}}" != "None") {  
                            vid.currentTime = "{{media_playback['position'].progress}}";
                        }
        
                    vid.onpause = () => {
                        const request = new XMLHttpRequest();
                        const id = "{{media_playback['media_id']}}"
                        request.open('POST', "/update_progress/" + id);
                        //define what happens with response data
                        request.onload = () => {
                            console.log("done")
                        };
                        var data = new FormData();
                        data.append('progress', vid.currentTime)
                        request.send(vid.currentTime);
                    };
                });
                });
            </script>
        {% else %}
            <h2 class="title"> Invalid TV Show Ep ID</h2>
        {% endif %}
    </div>
</div>
{% include 'bottom.html'%}
